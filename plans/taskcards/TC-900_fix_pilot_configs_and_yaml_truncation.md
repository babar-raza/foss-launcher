---
id: TC-900
title: "Fix pilot configs and add VFV preflight checks"
status: In-Progress
priority: Critical
owner: "AGENT_1_CONFIG_FIXER"
updated: "2026-02-01"
tags: ["pilot", "config", "validation", "golden-run"]
depends_on: []
allowed_paths:
  - plans/taskcards/TC-900_fix_pilot_configs_and_yaml_truncation.md
  - plans/taskcards/INDEX.md
  - plans/taskcards/STATUS_BOARD.md
  - specs/pilots/pilot-aspose-3d-foss-python/run_config.pinned.yaml
  - specs/pilots/pilot-aspose-note-foss-python/run_config.pinned.yaml
  - configs/pilots/*.resolved.yaml
  - reports/agents/**/TC-900/**
  - scripts/run_pilot_vfv.py
evidence_required:
  - reports/agents/AGENT_1_CONFIG_FIXER/TC-900/validation_output.log
  - reports/agents/AGENT_1_CONFIG_FIXER/TC-900/pytest_output.log
  - reports/agents/AGENT_1_CONFIG_FIXER/TC-900/evidence.md
spec_ref: c78c3ffbb53ece25d97372756b65a212d8d112a6
ruleset_version: ruleset.v1
templates_version: templates.v1
---

# Taskcard TC-900 â€” Fix pilot configs and add VFV preflight checks

## Objective
Eliminate all-zero placeholder SHAs from pilot configurations and implement VFV preflight checks to prevent golden runs with invalid placeholders. Ensure both pilot configs use real, pinned commit SHAs for reproducible builds.

## Required spec references
- specs/pilots/pilot-aspose-3d-foss-python/run_config.pinned.yaml
- specs/pilots/pilot-aspose-note-foss-python/run_config.pinned.yaml
- specs/09_validation_gates.md (Gate A validation)
- specs/10_determinism_and_caching.md (pinned commits)

## Scope
### In scope
- Replace all-zero placeholder SHAs in pilot-aspose-3d-foss-python config with real pinned commits
- Verify pilot-aspose-note-foss-python config already has correct SHAs
- Create VFV preflight script (run_pilot_vfv.py) that validates configs before golden runs
- Add --allow_placeholders flag for testing scenarios only
- Implement SHA validation and repo URL reporting in VFV script

### Out of scope
- Modifying pilot runtime behavior
- Changing workflow implementations (W1-W9)
- Updating resolved.yaml files (generated by orchestrator)

## Inputs
- Current pilot configs with placeholder SHAs
- Git remote repositories for SHA lookup
- Main branch baseline (GREEN: validate_swarm_ready PASS, pytest 1436 passed)

## Outputs
- specs/pilots/pilot-aspose-3d-foss-python/run_config.pinned.yaml with real SHAs
- scripts/run_pilot_vfv.py with preflight validation logic
- Validation logs confirming GREEN baseline maintained
- Evidence bundle with all changes and verification results

## Allowed paths
- plans/taskcards/TC-900_fix_pilot_configs_and_yaml_truncation.md
- plans/taskcards/INDEX.md
- plans/taskcards/STATUS_BOARD.md
- specs/pilots/pilot-aspose-3d-foss-python/run_config.pinned.yaml
- specs/pilots/pilot-aspose-note-foss-python/run_config.pinned.yaml
- configs/pilots/*.resolved.yaml
- reports/agents/**/TC-900/**
- scripts/run_pilot_vfv.py

## Implementation steps
1. **Get real commit SHAs for Pilot-1 (3D)**:
   - Query `git ls-remote https://github.com/aspose-3d-foss/Aspose.3d-FOSS-for-Python HEAD` for github_ref
   - Query `git ls-remote https://github.com/Aspose/aspose.org HEAD` for site_ref
   - Query `git ls-remote https://github.com/Aspose/aspose.org-workflows HEAD` for workflows_ref

2. **Update Pilot-1 config**:
   - Replace placeholder SHAs with real commits in run_config.pinned.yaml
   - Verify github_repo_url matches the ls-remote query
   - Preserve all other config settings

3. **Verify Pilot-2 config**:
   - Confirm pilot-aspose-note-foss-python already has valid SHAs
   - Document current state in evidence

4. **Create VFV preflight script** (scripts/run_pilot_vfv.py):
   - Validate no all-zero SHAs in default mode (golden runs)
   - Accept --allow_placeholders flag for testing only
   - Print repo URLs and SHAs before starting VFV
   - Exit with clear error message if placeholders detected
   - Include usage examples in docstring

5. **Run validation**:
   - Execute `tools/validate_swarm_ready.py` (must PASS)
   - Execute `python -m pytest -q` (must match baseline: 1436 passed)
   - Capture all output to evidence logs

6. **Create evidence bundle**:
   - Collect taskcard, modified configs, VFV script
   - Include validation and pytest logs
   - Package as tc900_evidence.zip

## E2E verification
**Concrete command(s) to run:**
```bash
# Validation baseline
.venv/Scripts/python.exe tools/validate_swarm_ready.py
.venv/Scripts/python.exe -m pytest -q

# VFV preflight check (when implemented)
.venv/Scripts/python.exe scripts/run_pilot_vfv.py --help
.venv/Scripts/python.exe scripts/run_pilot_vfv.py specs/pilots/pilot-aspose-3d-foss-python
```

**Expected artifacts:**
- scripts/run_pilot_vfv.py (new VFV harness)
- specs/pilots/pilot-aspose-3d-foss-python/run_config.pinned.yaml (updated SHAs)
- reports/agents/AGENT_1_CONFIG_FIXER/TC-900/validation_output.log
- reports/agents/AGENT_1_CONFIG_FIXER/TC-900/pytest_output.log

**Success criteria:**
- [ ] Pilot-1 config has no all-zero SHAs
- [ ] VFV script rejects configs with placeholder SHAs (default mode)
- [ ] VFV script accepts --allow_placeholders flag for testing
- [ ] validate_swarm_ready.py exits with code 0
- [ ] pytest passes all tests (1436 passed baseline)

## Integration boundary proven
What upstream/downstream wiring was validated:
- Upstream: Main branch baseline (GREEN)
- Downstream: Pilot golden runs will use validated configs
- Contracts: run_config.pinned.yaml schema compliance

## Failure modes

### Failure mode 1: Git ls-remote fails or returns invalid SHA
**Detection:** Git command exits non-zero or returns non-SHA value (not 40 hex chars); cannot query remote repository
**Resolution:** Verify network connectivity to github.com; check repo URL correctness (public repos accessible); try alternative refs (main vs master, HEAD); if repo unavailable, use surrogate repo with known-good SHA and document in DECISIONS.md
**Spec/Gate:** specs/10_determinism_and_caching.md (pinned refs requirement)

### Failure mode 2: VFV script incorrectly rejects valid SHAs
**Detection:** VFV preflight check fails on configs with real 40-char hex commits; false positive rejections
**Resolution:** Review SHA validation regex pattern; ensure it only rejects all-zero pattern (^0+$); test regex against both valid SHAs and all-zero placeholders; verify case-insensitive matching if needed
**Spec/Gate:** specs/09_validation_gates.md (Gate A - URL and SHA validation)

### Failure mode 3: Pytest count changes after config updates
**Detection:** Pytest output shows different pass/fail count than baseline (1436 passed expected); test suite regression
**Resolution:** Config changes should not affect test execution; verify no unintended code changes occurred; review git diff for unexpected modifications; revert config changes and investigate if tests still fail; baseline pytest before and after to isolate cause
**Spec/Gate:** Main branch baseline verification (GREEN baseline requirement)

## Technical Notes
- Pilot-1 (3D) currently has real-looking SHAs but they may be from wrong repo
- Pilot-2 (Note) has all-zero placeholders and needs correction
- VFV script should be standalone, runnable without full orchestrator
- SHA validation regex: `^0+$` detects all-zero placeholders
- Main branch baseline: 1436 tests passed

## Testing Plan
1. Unit test SHA validation logic in VFV script
2. Test VFV with valid config (should pass)
3. Test VFV with placeholder config (should fail unless --allow_placeholders)
4. Verify baseline: validate_swarm_ready.py + pytest
5. Test both pilot configs load correctly

## Task-specific review checklist
Beyond the standard acceptance checks, verify:
- [ ] All three SHAs (github_ref, site_ref, workflows_ref) updated for Pilot-1
- [ ] SHAs are 40-character hex strings (valid git commit format)
- [ ] VFV script has clear --help output with usage examples
- [ ] VFV script exits with appropriate return codes (0=pass, 1=fail)
- [ ] No manual edits to resolved.yaml files (those are generated)
- [ ] Evidence bundle includes before/after diffs of configs

## Deliverables
- Code:
  - scripts/run_pilot_vfv.py (new preflight harness)
  - Updated pilot-aspose-3d-foss-python/run_config.pinned.yaml
- Tests:
  - Baseline validation maintained (1436 tests passing)
- Reports (required):
  - reports/agents/AGENT_1_CONFIG_FIXER/TC-900/evidence.md
  - reports/agents/AGENT_1_CONFIG_FIXER/TC-900/validation_output.log
  - reports/agents/AGENT_1_CONFIG_FIXER/TC-900/pytest_output.log
- Evidence:
  - runs/tc900_config_fixer_20260201_HHMMSS/tc900_evidence.zip

## Acceptance Criteria
- [ ] Pilot-1 (3D) config has real, pinned commit SHAs (no all-zero placeholders)
- [ ] Pilot-2 (Note) config verified (document current state)
- [ ] VFV script created with preflight validation logic
- [ ] VFV script rejects placeholder SHAs by default
- [ ] VFV script accepts --allow_placeholders flag
- [ ] VFV script prints repo URLs and SHAs before execution
- [ ] validate_swarm_ready.py passes (GREEN)
- [ ] pytest passes with baseline count (1436 passed)
- [ ] Evidence bundle created with all artifacts
- [ ] Branch tc-900-config-fixer-20260201 created

## Evidence
Evidence will be collected in:
- reports/agents/AGENT_1_CONFIG_FIXER/TC-900/evidence.md
- runs/tc900_config_fixer_20260201_HHMMSS/tc900_evidence.zip

Required evidence items:
- Git ls-remote outputs showing real SHAs
- Diff of pilot-aspose-3d-foss-python/run_config.pinned.yaml
- VFV script source code
- validate_swarm_ready.py output (PASS)
- pytest output (1436 passed)

## Acceptance checks
- [ ] Pilot-1 config updated with real SHAs from ls-remote
- [ ] Pilot-2 config updated with real SHAs from ls-remote
- [ ] Both pilots have no all-zero placeholder SHAs
- [ ] VFV script validates SHA format (40-char hex)
- [ ] VFV script rejects all-zero SHAs by default
- [ ] VFV script --allow_placeholders flag works for testing
- [ ] VFV script prints repo URLs and SHAs before validation
- [ ] validate_swarm_ready.py exits with code 0
- [ ] pytest passes all tests (baseline maintained)
- [ ] Evidence bundle created and contains all required artifacts
- [ ] No write fence violations (only allowed_paths modified)

## Self-review
Use `reports/templates/self_review_12d.md`. Any dimension <4 must include a concrete fix plan.
